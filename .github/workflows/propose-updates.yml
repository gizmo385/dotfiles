name: Attempts to update dependencies and validate that the upgrade is safe

on:
  workflow_dispatch:
  push:
    branches: ['*']
  #schedule:
    # Attempt to update things every Monday at 16:00 UTC (~ mid-morning mountain time)
    #- cron: "0 16 * * 1"

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  propose-dotfile-version-updates:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup nix
        uses: cachix/install-nix-action@v27

      - name: Update flake versions
        id: update-versions
        run: |
          update_output=$(nix flake update)
          echo 'update_output="${update_output}"' >> $GITHUB_OUTPUT

      - name: Validate outputs
        run: echo ${{ steps.update-versions.outputs.update_output }}
          
