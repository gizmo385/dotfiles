name: Attempts to update dependencies and validate that the upgrade is safe

on:
  workflow_dispatch:
  push:
    branches: ['*']
  pull_request:
    types:
      - opened
  #schedule:
    # Attempt to update things every Monday at 16:00 UTC (~ mid-morning mountain time)
    #- cron: "0 16 * * 1"

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  propose-dotfile-version-updates:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup nix
        uses: cachix/install-nix-action@v27

      - name: Update flake versions
        id: update-versions
        run: |
          {
            echo 'FLAKE_OUTPUT<<EOF'
            nix flake update 2>&1
            echo EOF
          } >> "$GITHUB_ENV"

      - name: Validate outputs
        run: echo ${{ steps.update-versions.outputs.FLAKE_OUTPUT }}
          
